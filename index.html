<html>
<head>
<meta charset="UTF-8">
<title>Pifomètre</title>
<script src="js/jquery-3.6.4.min.js"></script>
<script src="js/jquery.tablesorter.combined.min.js"></script>
<script src="js/fonctions.js"></script>
<link rel="preload" href="css/fonts/opensans-latin.woff2" as="font" type="font/woff2" crossorigin>
<link rel="stylesheet" href="css/bulma/bulma.min.css" type="text/css"/>
<link rel="stylesheet" href="css/bulma/main.min.css" type="text/css"/>
<link rel="stylesheet" href="css/tablesorter/theme.default.min.css" type="text/css"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/responsive.css" type="text/css"/>
<link rel="search" type="application/opensearchdescription+xml" title="Pifomètre BANO" href="opensearch.xml" />
<script>
    FILTRES = [["voie",true],
               ["lieu_dit",true],
               ["osm_hors_fantoir",true],
               ["nom_integre",true],
               ["nom_a_integrer",true],
               ["avec_adresses",true],
               ["sans_adresses",true]]

    DELTA = 0.0008

    var table = 'table_pifometre'

    function start(){
        $('#table_communes_voisines').css('visibility','hidden');
        $('#table_communes_voisines table tr td').empty()
                                                 .removeAttr('insee_cible')
                                                 .unbind('click');

        let [a_menus_labels,STATUS_FANTOIR] = get_labels_statut_fantoir()

        check_josm_remote_control()
        insee = check_url_for_insee()
        if (insee){
            $('#input_insee').empty()
            $('#input_insee')[0].value = insee
            requete_pifometre()
        }
        $('#bouton_aleatoire').attr('title', 'Une commune au pif\noù dégommer du rouge');
        $('#bouton_aleatoire').click(function(){
            commune_aleatoire()
        })
        $('#bouton_communes_voisines').click(function(){
            $('#table_communes_voisines').css('visibility','visible');
        })
        $('#table_communes_voisines > .fermer').click(function(){
            $('#table_communes_voisines').css('visibility','hidden');
        })

        $('#bouton_refresh').click(function(event){
                                refresh();
                                event.stopPropagation();
                            })
                            .mouseover(function(event){
                                get_osm_state();
                                refresh_infobulle();
                                event.stopPropagation();
                            })
                            .mouseout(function(){
                                $('#refresh_infobulle').hide()
                            })
    };

    function commune_aleatoire(){
        $.ajax({
            url: "requete_commune_random.py"
        })
        .done(function( data ) {
            $('#input_insee')[0].value = data[0][0]
            requete_pifometre()
        })
    }
    
    function refresh(){
        if (commune_valide == false){
            return 0;
        }
        $('body').css('cursor','progress');
        $('#wait_ajax').empty()
                       .css('visibility','visible') 
                       .append($('<span>').append('Mise à jour BANO en cours...'));
        $.ajax({
            url: "refresh.py?insee="+$('#input_insee')[0].value,
        })
        .done(function( data ){
            if (data == '1'){
                requete_pifometre();
            } else {
                alert('Problème lors de la mise à jour')
            }
            $('body').css('cursor','default');
            $('#wait_ajax').css('visibility','hidden');
        })
    }

    function update_filtres(){
        for (let i = 0; i < FILTRES.length; i++){
            FILTRES[i] = [FILTRES[i][0],$('#check_'+FILTRES[i][0]).is(':checked')]
        }
    }
    function reset_filtres(){
        for (let i = 0; i < FILTRES.length; i++){
            FILTRES[i] = [FILTRES[i][0],true]
        }
        $('#boutons-filtres input').prop('checked',true)
    }
    function active_menu_filtres(){
        $('#boutons-filtres input').click(function(){
            show_mask_lines()
            update_menu_filtres()
        })
    };
    function update_menu_filtres(){
        $('#boutons-filtres li span.control-label').each(function(){
            total = $('#'+table+' tr.'+$(this).attr('critere')).length
            visible = $('#'+table+' tr:visible.'+$(this).attr('critere')).length
            $(this).children('span').text(' ('+visible+' / '+total+')')
        })
    };
    function show_mask_lines(){
        update_filtres()
        $('#'+table+' tbody tr').each(function() {
           action = 'donotfilter'
           for (let f of FILTRES){
                if ($(this).hasClass(f[0]) && f[1] == false){
                    action = 'filter'
                }
                $(this).removeClass('filtered')
                if (action == 'filter'){
                    $(this).addClass('filtered')
                }
            }
       });
    }

    function requete_pifometre(){
        commune_valide = false;
        $('body').css('cursor','progress');
        $('#'+table).trigger("destroy");
        $('#'+table).empty()
        $('#input_insee')[0].value = $('#input_insee')[0].value.toUpperCase()
        $.ajax({
            url: "requete_pifometre_commune.py?insee="+$('#input_insee')[0].value
        })
        .done(function( pifodata ) {
            let [nom_commune,
                 lon_commune,
                 lat_commune,
                 communes_voisines,
                 insee_commune_parente,
                 nom_commune_parente,
                 date_dernier_rapprochement,
                 commune_composee,
                 bbox_diagonale,
                 nb_adresses_osm,
                 nb_adresses_ban,
                 nb_noms_osm,
                 nb_noms_ban,
                 nb_nom_adr_osm,
                 nb_noms_cadastre,
                 nb_noms_topo] = pifodata

            document.title = nom_commune+' - Pifomètre'
            $('#descriptif').empty()
            $('#alerte_commune').css('visibility','hidden');

            if (nom_commune.length == 0){
                $('#descriptif').append($('<div id="titre_commune_inconnue">').append($('<h1>').append('Code Insee '+$('#input_insee')[0].value+' : commune inconnue')))
                $('body').css('cursor','default');
                return 0;
            }
            commune_valide = true;
            $('#pifostats').css('visibility','visible');

            code_insee = $('#input_insee')[0].value
            update_csv_url()
            $('#wait_ajax').empty()
                           .css('visibility','visible')
                           .append($('<span>').append('Chargement des données...'));


            url_map_org_part1 = 'http://www.openstreetmap.org/'
            url_pifomap = 'pifomap.html?insee='+code_insee
            url_bano = 'http://layers.openstreetmap.fr/?zoom=15&lat='+lat_commune+'&lon='+lon_commune+'&layers=0B00000000FFFFFFFFFFFFFFFFFFFFFFFFT'
            url_edit_part1 = 'http://www.openstreetmap.org/edit?editor='
            delta = 0.0008
            url_hash_coords = '15/'+lat_commune+'/'+lon_commune
            url_listing_fantoir = './liste_brute_fantoir.html?insee='+$('#input_insee')[0].value

            $('#descriptif').append($('<div id="infos_commune_col1">')
                                    .append($('<div id="date-maj">')
                                        .append($('<div>').addClass('cellule_intitule').append('<strong>Dernier rapprochement le</strong>'))
                                        .append($('<div>').addClass('cellule_data').append('&nbsp;').append(date_dernier_rapprochement).append(' (UTC)<br/>'))
                                    )
                                    .append($('<div id="liens_commune">').append('<strong>Voir la commune sur :</strong> ')
                                        .append($('<a>')
                                            .attr('target','blank')
                                            .attr('href',url_map_org_part1+'?mlat='+lat_commune+'&mlon='+lon_commune+'#map='+url_hash_coords)
                                            .text('ORG')
                                        ))
            )
            if (!insee_commune_parente){
                     $('#liens_commune').append(' / ')
                                        .append($('<a>')
                                            .attr('target','blank')
                                            .attr('href','https://adresse.data.gouv.fr/base-adresse-nationale/'+$('#input_insee')[0].value)
                                            .text('BAN')
                                        )
            }
            $('#liens_commune').append(' / ')
                               .append($('<a>')
                                   .attr('target','blank')
                                   .attr('href',url_bano)
                                   .text('BANO')
                               )
                               .append(' / ')
                               .append($('<a>')
                                   .attr('target','blank')
                                   .attr('href',url_listing_fantoir)
                                   .text('Topo (ex-Fantoir)')
                               )
                               .append(' / ')
                               .append($('<a>')
                                   .attr('target','blank')
                                   .attr('href','pifomap.html?insee='+code_insee)
                                   .text('Pifomap')
                               )

            $('#descriptif').append($('<div id="infos_commune_col2">').append($('<h1>').append((nom_commune))))

            //------------------------------------
            //-------   COMMUNES VOISINES   ------
            //------------------------------------

            $('#table_communes_voisines tr td').empty()
            $('#table_communes_voisines tr td.commune_centre').text(nom_commune)
            for (v in communes_voisines){
                $('#table_communes_voisines tr td#'+(communes_voisines[v])[0]).append($('<a>')
                                                                              .addClass('lien_commune')
                                                                                  .attr('href',window.location.href.split('?')[0]+'?insee='+communes_voisines[v][1])
                                                                                  .text(communes_voisines[v][2]))
            }

            //------------------------------------
            //-------       PIFOSTATS       ------
            //------------------------------------

            pourcent_adresses_osm = nb_adresses_osm*100/Math.max(nb_adresses_ban,1)
            pourcent_noms_avec_adresses_osm = nb_nom_adr_osm*100/Math.max(nb_noms_ban,1)
            pourcent_noms_osm = nb_noms_osm*100/Math.max(nb_noms_topo,1)

            $('#pifostats .barre_noms_texte').text(nb_noms_osm+' noms OSM'+' (soit '+Math.round(pourcent_noms_osm)+'% des '+nb_noms_topo+' noms Topo)')
            $('#pifostats .barre_noms_osm').attr('aria-valuenow', Math.min(100, Math.round(pourcent_noms_osm)))

            $('#pifostats .barre_noms_avec_adresses_texte').text(nb_nom_adr_osm+' noms OSM avec adresses'+' (soit '+Math.round(pourcent_noms_avec_adresses_osm)+'% des '+nb_noms_ban+' noms BAN)')
            $('#pifostats .barre_noms_avec_adresses_osm').attr('aria-valuenow', Math.min(100, Math.round(pourcent_noms_avec_adresses_osm)))

            $('#pifostats .barre_adresses_texte').text(nb_adresses_osm+' adresses OSM'+' (soit '+Math.round(pourcent_adresses_osm)+'% des '+nb_adresses_ban+' adresses BAN)')
            
            $('#pifostats .barre_adresses_osm').attr('aria-valuenow', Math.min(100, Math.round(pourcent_adresses_osm)))


            $("#pifostats .barre_noms .barre_noms_osm") .stop(true, true)
                                                        .delay(1000)
                                                        .animate({width: Math.min(100, Math.round(pourcent_noms_osm))+'%'}, 1000);

            $("#pifostats .barre_noms_avec_adresses .barre_noms_avec_adresses_osm") .stop(true, true)
                                                        .delay(1000)
                                                        .animate({width: Math.min(100, Math.round(pourcent_noms_avec_adresses_osm))+'%'}, 1000);

            $("#pifostats .barre_adresses .barre_adresses_osm") .stop(true, true)
                                                                .delay(1000)
                                                                .animate({width: Math.min(100, Math.round(pourcent_adresses_osm))+'%'}, 1000);
            $('#lien_map_noms').attr('href','pifomap.html?ratio=N#map=10/'+lat_commune+'/'+lon_commune)
            $('#lien_map_noms_avec_adresses').attr('href','pifomap.html?ratio=NA#map=10/'+lat_commune+'/'+lon_commune)
            $('#lien_map_adresses').attr('href','pifomap.html?ratio=A#map=10/'+lat_commune+'/'+lon_commune)

            
            if (insee_commune_parente){
                $('#alerte_commune').empty();
                $('#alerte_commune').css('visibility','visible');
                $('#alerte_commune').append($('<div>').addClass('fermer-alerte').text('X'))
                $('#alerte_commune > .fermer-alerte').click(function(){
                    $('#alerte_commune').css('visibility','hidden');
                })
                $('#alerte_commune').append($('<p>').text(nom_commune+' est une ancienne commune. Elle a été incorporée dans ')
                                    .append($('<a>').addClass('lien_commune')
                                                    .attr('href',window.location.href.split('?')[0]+'?insee='+insee_commune_parente)
                                                    .text(nom_commune_parente+' ('+insee_commune_parente+')')))
            }
            $.ajax({
                url: "requete_pifometre_voies.py?insee="+$('#input_insee')[0].value
            })
            .done(function( data ) {
                reset_filtres()
                $('#'+table).trigger("destroy");
                $('#'+table).empty()
                $('#'+table).append($('<thead>').append($('<tr>').append($('<th>').append('Code Fantoir'))))
                $('#'+table+' tr').append($('<th>').append('Date de création'))
                if (commune_composee == 1){
                    $('#'+table+' tr').append($('<th>').append('Ancienne commune'))
                }
                $('#'+table+' tr').append($('<th>').append('Libellé Topo (ex Fantoir)'))
                $('#'+table+' tr').append($('<th>').append('Libellé OSM'))
                $('#'+table+' tr').append($('<th>').append('Libellé BAN ou Cadastre'))
                $('#'+table+' tr').append($('<th>').attr('colspan','2').append('Carte'))
                $('#'+table+' tr').append($('<th>').attr('colspan','2').append('Edition'))
                $('#'+table+' tr').append($('<th title="ex statut Fantoir">').append('Statut du nom ').append($('<a>').attr('href','http://wiki.openstreetmap.org/wiki/Contribuer_%C3%A0_la_BANO#Typologie_des_anomalies_FANTOIR').append('(wiki)')))
                $('#'+table+' tr').append($('<th>').attr('colspan','2').addClass('string-none').append('Intégrer les adresses'))
                $('#'+table+' tr').append($('<th>').append('Qualifier les adresses'))
                $('#'+table).append($('<tbody>'))

                tr_id = 1000
                for (s=0;s<data.length;s++){
                    let [fantoir,
                         date_creation,
                         annule,
                         nom_topo,
                         nom_osm,
                         nom_ban,
                         source_nom_ban,
                         nom_ancienne_commune,
                         lon,
                         lat,
                         statut_voie,
                         numeros_a_proposer,
                         caractere_annul,
                         categorie,
                         avec_adresses_ban] = data[s]

                    let [is_voie,
                        is_place,
                        is_osm_hors_fantoir,
                        has_code_fantoir,
                        fantoir_affiche,
                        fantoir_dans_relation] = parse_pifometre(categorie,caractere_annul,fantoir)

                    tr_id+=1

                    // Doublons de vrais FANTOIRs détectés à tort en pseudo-FANTOIRs BAN => masqués
                    if (!has_code_fantoir && nom_ban == undefined){
                        continue;
                    }

                    //-------------------------------------------------------------------
                    //-------------------------------------------------------------------
                    //--------------------   REMPLISSAGE CELLULES   ---------------------
                    //-------------------------------------------------------------------
                    //-------------------------------------------------------------------

                    //--- Code Fantoir ---
                    if (has_code_fantoir) {
                        $('#'+table+' tbody').append($('<tr>').attr('id',tr_id).append($('<td>').attr('fantoir',fantoir).addClass('cell_fantoir').text(fantoir_affiche)))                    
                    }
                    else {
                        $('#'+table+' tbody').append($('<tr>').attr('id',tr_id).append($('<td>').attr('colspan','3').attr('fantoir',fantoir).addClass('cell_fantoir').text(fantoir_affiche))) 
                    }
                    if (annule == -1){
                        $('#'+table+' tr:last td:last').addClass('cell_mauvais_fantoir').attr('title','Code Fantoir annulé, à remplacer dans OSM')
                    } else if (fantoir_affiche != null && is_osm_hors_fantoir){
                        $('#'+table+' tr:last td:last').addClass('cell_mauvais_fantoir').attr('title','Code Fantoir erroné, à corriger dans OSM')
                    }

                    //Ajout des classes pour les filtres à chaque ligne
                    if (is_voie) {
                        $('#'+table+' tr:last').addClass('voie')
                    }
                    if (is_place){
                        $('#'+table+' tr:last').addClass('lieu_dit')
                    } 
                    if (is_osm_hors_fantoir) {
                        $('#'+table+' tr:last').addClass('osm_hors_fantoir')
                    }
                    if (!is_osm_hors_fantoir){
                        if (nom_osm == undefined) {
                            $('#'+table+' tr:last').addClass('nom_a_integrer')
                        } else {
                            $('#'+table+' tr:last').addClass('nom_integre')
                        }
                        if (avec_adresses_ban) {
                            $('#'+table+' tr:last').addClass('avec_adresses')
                        } else {
                            $('#'+table+' tr:last').addClass('sans_adresses')
                        }
                    }
                    
                    //--- Date de création Fantoir ---
                    if (has_code_fantoir) {
                        $('#'+table+' tr:last').append($('<td>').text(date_creation))
                    }

                    //--- Nom de l'ancienne commune ---
                    if (commune_composee == 1){
                        $('#'+table+' tr:last').append($('<td>').text(nom_ancienne_commune))
                    }

                    //--- Nom Fantoir ---
                    if (is_place && has_code_fantoir){
                        $('#'+table+' tr:last').append($('<td>')
                                                    .append($('<img>').attr('src','img/lieudit.png').attr('width','20px').attr('title','Lieu-dit'))
                                                    .append($('<span>').text(' '+nom_topo)))
                    }
                    else if (is_voie && has_code_fantoir){
                        $('#'+table+' tr:last').append($('<td>')
                                                    .append($('<img>').attr('src','img/voie.png').attr('title','Voie'))
                                                    .append($('<span>').text(' '+nom_topo)))
                    }
                    else if (is_osm_hors_fantoir){
                        $('#'+table+' tr:last').append($('<td>'))
                    }

                    //--- Nom OSM ---
                    if ($('#'+table+' tr:last').hasClass('nom_integre')){
                        $('#'+table+' tr:last').append($('<td>')
                                                        .append($('<span class="pastille-verte" title="Déjà rapproché dans OSM">'))
                                                        .append($('<span>').text(nom_osm)))
                    }
                    else if ($('#'+table+' tr:last').hasClass('nom_a_integrer')){
                        $('#'+table+' tr:last').append($('<td>')
                                                        .append($('<span class="pastille-orange" title="Pas encore rapproché dans OSM">'))
                                                        .append($('<span>').text(nom_osm)))
                    } else {
                        $('#'+table+' tr:last').append($('<td>')
                                                        .append($('<span class="pastille-bleue" title="Trouvé dans OSM mais inconnu de Fantoir">'))
                                                        .append($('<span>').text(nom_osm)))
                    }
                    //--- Nom BAN ou Cadastre ---
                    if (source_nom_ban == 'CADASTRE') {
                        $('#'+table+' tr:last').append($('<td>').append($('<span class="picto cadastre" title="Nom provenant du cadastre">'))
                                                                .append($('<span>').text(nom_ban)))
                    }
                    else if (source_nom_ban == 'BAN') {
                        $('#'+table+' tr:last').append($('<td>').append($('<span class="picto ban" title="Nom provenant de la BAN">'))
                                                                .append($('<span>').text(nom_ban)))
                    }
                    else $('#'+table+' tr:last').append($('<td>').text(nom_ban))

                    //--- Visu ---
                    xmin  = lon-DELTA
                    xmax  = lon+DELTA
                    ymin  = lat-DELTA
                    ymax  = lat+DELTA

                    if (lat != null || lon != null) {
                        $('#'+table+' tr:last').append($('<td>')
                                        .append($('<a>')
                                        .attr('href',url_map_org_part1+'#map='+'18/'+lat+'/'+lon)
                                        .attr('target','blank')
                                        .text('ORG')))
                        $('#'+table+' tr:last').append($('<td>')
                                        .append($('<a>')
                                        .attr('href',url_pifomap+'#map='+'18/'+lat+'/'+lon)
                                        .attr('target','blank')
                                        .text('Pifomap')))
                    }
                    else {
                        $('#'+table+' tr:last').append($('<td>').addClass('no-loca').attr('title', 'Objet inconnu d\'OSM, de la BAN et du cadastre\ndonc sans localisation connue.').text('x'))
                        $('#'+table+' tr:last').append($('<td>').addClass('no-loca').attr('title', 'Objet inconnu d\'OSM, de la BAN et du cadastre\ndonc sans localisation connue.').text('x'))
                    }

                    //--- JOSM ---
                    if (lon != undefined) {
                        add_josm_link(table,xmin,xmax,ymin,ymax,code_insee,nom_commune)
                    } else {
                        $('#'+table+' tr:last').append($('<td>').addClass('no-loca').attr('title', 'Objet inconnu d\'OSM, de la BAN et du cadastre\ndonc sans localisation connue.').text('x'))
                    }
                    //--- iD ---
                    if (lon != undefined) {
                        add_id_link(table,'http://www.openstreetmap.org/edit?editor=id#map=18/'+lat+'/'+lon,'ID')
                    } else {
                        $('#'+table+' tr:last').append($('<td>').addClass('no-loca').attr('title', 'Objet inconnu d\'OSM, de la BAN et du cadastre\ndonc sans localisation connue.').text('x'))
                    }

                    //--- Statut Fantoir ---
                    if (caractere_annul != 'B' && is_osm_hors_fantoir == false){
                        add_statut_fantoir(table,tr_id,fantoir,statut_voie)
                    } else {
                        $('#'+table+' tr:last').addClass('statut0').append($('<td>'))
                    }
                    //--- Adresses à integrer ----
                    if (numeros_a_proposer > 0){
                        add_josm_addr_link(table,$('#input_insee')[0].value,nom_commune,fantoir,nom_topo,numeros_a_proposer,fantoir_dans_relation,is_place)
                    }
                    else if (numeros_a_proposer == null && avec_adresses_ban){
                        $('#'+table+' tr:last').append($('<td>').attr('colspan','2').addClass('zone-adresses')
                                                        .append($('<span>').addClass('adresses-integrees').text('✔'))
                                                        .append($('<span>').text(' Adresses intégrées'))
                                                    )
                    }
                    else {
                        $('#'+table+' tr:last').append($('<td>').attr('colspan','2'))
                    }

                    //--- Qualification des adresses ---
                    if (avec_adresses_ban && has_code_fantoir){
                        add_addr_inspector_link(table,$('#input_insee')[0].value,fantoir,'BAN')
                    } else {
                        $('#'+table+' tr:last').append($('<td>'))
                    }
                }
                $('#wait_ajax').css('visibility','hidden');

                //Sticky headers : le tableau scrolle dans son contenant
                $('#'+table).tablesorter({
                    widthFixed : true,
                    headerTemplate : '{content} {icon}', // Add icon for various themes
                    widgets: [ 'stickyHeaders', 'filter' ],
                    widgetOptions: {
                      stickyHeaders_attachTo : '#reponse'
                    }
                });

                active_menu_filtres()
                update_menu_filtres()
            })
            history.replaceState("", "", window.location.pathname+"?insee="+$('#input_insee')[0].value)
            $('body').css('cursor','default');
        })
    };
    function update_csv_url(){
        urlCSV = 'requete_pifometre_voies.py?insee='+$('#input_insee')[0].value+'&format=csv';
    }
    function get_osm_state(){
        $.ajax({
            url: "osm_state.py",
            async:false
        })
        .done(function( data ){
            osm_state = data;
        })
    }
    function refresh_infobulle(){
        $('#refresh_infobulle').empty()
                            .append('Mettre à jour avec les données OSM du ')
                            .append($('<span>').append(osm_state+' (UTC)'))
                            .show()
    }
</script>
</head>

<body onload="start()">
    <header>
        <!--#include file="includes/menu.html" -->
    </header>

    <div id="barre-jaune">
        <span>Commune :</span>
        <form action="javascript:requete_pifometre()" autocomplete="on">
            <input type="text" id="input_insee" placeholder="Code INSEE"></input>
            <input type="submit" value="Lister">
        </form>
    </div>

    <div id="bandeau">
        <div id="descriptif" class ="pifo"></div>
        <div id="refresh_infobulle"></div>
        <div id="table_communes_voisines">
            <div class="fermer">X</div>
            <table>
            <tbody>
                <tr><td id="11"></td><td id="12"></td><td id="1"></td><td id="2"></td></tr>
                <tr><td id="10"></td><td class="commune_centre" colspan="2" rowspan="2"></td><td id="3"></td></tr>
                <tr><td id="9"></td><td id="4"></td></tr>
                <tr><td id="8"></td><td id="7"></td><td id="6"></td><td id="5"></td></tr>
            </tbody>
            </table>
        </div>
        <!--Boutons tout en haut à droite-->
        <div id="wait_ajax" class="pifo"></div>
        <button id="bouton_aleatoire" title="Une commune au pif"></button>
        <button id="bouton_communes_voisines" title="Communes voisines"></button>
        <button id="bouton_refresh"></button>
        <button id="bouton_export_csv" title="Exporter le tableau en CSV" onclick="window.open(urlCSV, '_blank');"></button>
        <button id="bouton_aide" title="Ouvrir la page d'aide" onclick="window.open('aide.html', '_blank');"></button>
        <div id="infos_refresh"></div>

        <!------------------------------------------------------------->
        <!------------------ Espace en haut à droite ------------------>
        <!------------------------------------------------------------->

        <div id="alerte_commune"></div>


        <!------------------------------------------------------------->
        <!-----------------------   Pifostats   ----------------------->
        <!------------------------------------------------------------->

        <div id="pifostats" class="pifomap">
            <div><h3>Intégration des voies et adresses de la commune</h3></div>

            <div class="barre_noms"> 
                <div class="barre_noms_texte"></div> 
                <div class="barre_noms_tous" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuetext="" aria-valuemax="100">
                    <div class="barre_noms_osm"></div>
                </div>
            <a id="lien_map_noms" href="pifomap.html" title="voir la carte de la progression dans la région"><img class="picto_france" src="img/france-blanc-points.png"/></a>
            </div>

            <div class="barre_noms_avec_adresses"> 
                <div class="barre_noms_avec_adresses_texte"></div> 
                <div class="barre_noms_avec_adresses_tous" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuetext="" aria-valuemax="100">
                    <div class="barre_noms_avec_adresses_osm"></div>
                </div>
            <a id="lien_map_noms_avec_adresses" href="pifomap.html" title="voir la carte de la progression dans la région"><img class="picto_france" src="img/france-blanc-points.png"/></a>
            </div>

            <div class="barre_adresses"> 
                <div class="barre_adresses_texte"></div> 
                <div class="barre_adresses_tous" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuetext="" aria-valuemax="100">
                    <div class="barre_adresses_osm"></div>
                </div>
            <a id="lien_map_adresses" href="pifomap.html" title="voir la carte de la progression dans la région"><img class="picto_france" src="img/france-blanc-points.png"/></a>
            </div>

        </div>

        <!------------------------------------------------------------->
        <!----------------------- ESPACE FILTRES ---------------------->
        <!------------------------------------------------------------->

        <div id="boutons-filtres" class="pifo">
            <p id="ligne-afficher">Afficher :</p>
            <div class="ligne-boutons-filtres">
                <div>
                    <ul>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_voie" checked>
                            <span class="check is-dark"></span>
                            <span class="control-label" critere="voie">Voies<span></span></span>
                        </li>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_lieu_dit" checked>
                            <span class="check is-dark"></span>
                            <span class="control-label" critere="lieu_dit">Lieux-dits<span></span></span>
                        </li>
                    </ul>
                </div>
                <div>
                    <ul>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_nom_integre" checked>
                            <span class="check is-green"></span>
                            <span class="control-label" critere="nom_integre">Déjà rapprochés dans OSM<span></span></span>
                        </li>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_nom_a_integrer" checked>
                            <span class="check is-orange"></span>
                            <span class="control-label" critere="nom_a_integrer">Pas encore rapprochés dans OSM<span></span></span>
                        </li>
                    </ul>
                </div>
                <div>
                    <ul>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_avec_adresses" checked>
                            <span class="check is-pink"></span>
                            <span class="control-label" critere="avec_adresses">Ayant des adresses référencées dans la BAN<span></span></span>
                        </li>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_sans_adresses" checked>
                            <span class="check is-dark"></span>
                            <span class="control-label" critere="sans_adresses">Sans adresses<span></span></span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="ligne-boutons-filtres">
                <div>
                    <ul>
                        <li>
                            <label class="switch is-rounded is-small">
                            <input type="checkbox" id="check_osm_hors_fantoir" checked>
                            <span class="check is-blue"></span>
                            <span class="control-label" critere="osm_hors_fantoir">Trouvé dans OSM et inconnu du fichier Topo<span></span></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="reponse" class="pifo">
        <table id="table_pifometre" class="avec_statuts"></table>
    </div>
    <footer>
    <!--#include file="includes/footer.html" -->
    </footer>
    <div id="josm_target" style="visibility : hidden"></div>
</body>
</html>
