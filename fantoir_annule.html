<html>
<head>
<meta charset="UTF-8">
<title>Codes Fantoir annulés</title>
<link rel="preload" href="css/fonts/opensans-latin.woff2" as="font" type="font/woff2" crossorigin>
<script src="js/jquery-3.6.4.min.js"></script>
<script src="js/tablesorter/jquery.tablesorter.js"></script>
<script src="js/jquery.tablesorter.combined.min.js"></script>
<script src="js/fonctions.js"></script>
<link rel="stylesheet" href="css/tablesorter/theme.default.min.css" type="text/css"/>
<link rel="stylesheet" href="css/style.css" type="text/css"/>
<link rel="stylesheet" href="css/responsive.css" type="text/css"/>

<script>
    var titre = "Codes Fantoir annulés"
    function start(){
        document.title = titre
        numero_dept = check_url_for_dept()
        if (numero_dept){
            $('#input_dept').empty()
            $('#input_dept')[0].value = numero_dept
            requete_fantoir_annule_dept();
        }
    }
    function requete_fantoir_annule_dept(){
        if (check_form_for_dept()){
            numero_dept = $('#input_dept')[0].value
            document.title = titre+' ('+numero_dept+')'

            $('body').css('cursor','progress');
            $('#wait_ajax').empty()
                            .css('visibility','visible')
                            .append($('<p>').append('Chargement des codes Fantoir annulés...'))
            $.ajax({
                url: "fantoir_annule.py?dept="+numero_dept,
            })
            .done(function( data ){
                nom_dept = data[0][0][1]
                code_dept = data[0][0][0]

                data = data[1]
                titre_bandeau = ' codes Fantoir annulés'
                if (data.length < 2){
                    titre_bandeau = ' code Fantoir annulé'
                }
                $('#bandeau h1').empty().append(data.length+titre_bandeau)
                $('#bandeau h2').empty().append(nom_dept+' ('+numero_dept+')')
                $('#bandeau h4').empty().append("Codes trouvés dans OSM mais annulés d'après le fichier Topo (ex Fantoir) officiel.<br />Noms de voies remplacés, voies en double dont un seul code est conservé... Pour les communes fusionnées, les nouveaux codes Fantoir sont à retrouver sur la page de la nouvelle commune.")

                $('#wait_ajax').css('visibility','hidden');

                url_map_org_part1 = 'http://www.openstreetmap.org/'
                delta = 0.0008

                $('#table_fantoir_annule').trigger("destroy");
                $('#table_fantoir_annule').empty()

                $('#table_fantoir_annule').append($('<thead>').append($('<tr>').append($('<th>').append('Dept'))))
                $('#table_fantoir_annule tr').append($('<th>').append('Commune (code Insee)'))
                $('#table_fantoir_annule tr').append($('<th>').append('Code Fantoir annulé'))
                $('#table_fantoir_annule tr').append($('<th>').append('Voie OSM'))
                $('#table_fantoir_annule tr').append($('<th>').append('Date d\'annulation'))
                $('#table_fantoir_annule tr').append($('<th>').attr('colspan','1').append('Carte'))
                $('#table_fantoir_annule tr').append($('<th>').attr('colspan','1').append('Édition'))
                $('#table_fantoir_annule tr').append($('<th>').attr('colspan','3').append('Voir la commune sur...'))

                $('#table_fantoir_annule').append($('<tbody>'))
                for (l=0;l<data.length;l++){
                    let [fantoir,
                        nom,
                        lon,
                        lat,
                        date_annul,
                        dept,
                        commune] = data[l]
                    insee = fantoir.substr(0,5)

                    //Dept
                    $('#table_fantoir_annule').append($('<tr>').attr('id',fantoir).append($('<td>').text(dept)))
                    //Commune (Insee)
                    $('#table_fantoir_annule tr:last').append($('<td>').text(commune+' ('+insee+')'))
                    //Fantoir
                    $('#table_fantoir_annule tr:last').append($('<td>').addClass('cell_mauvais_fantoir').text(fantoir))
                    //Nom OSM
                    $('#table_fantoir_annule tr:last').append($('<td>').text(nom))
                    //Date d'annulation
                    $('#table_fantoir_annule tr:last').append($('<td>').text(date_annul))
                    url_hash_coords = '18/'+lat+'/'+lon
                    xleft   = lon-delta
                    xright  = lon+delta
                    ybottom = lat-delta
                    ytop    = lat+delta
                    //visu
                    add_map_link('table_fantoir_annule',url_map_org_part1+'#map='+url_hash_coords,'ORG')
                    //JOSM
                    add_josm_link('table_fantoir_annule',xleft,xright,ybottom,ytop,insee,commune)
                    //Fantoir
                    add_map_link('table_fantoir_annule','./index.html?insee='+insee,'Pifomètre')
                    add_map_link('table_fantoir_annule','./pifomap.html?insee='+insee+'#map='+url_hash_coords,'Pifomap')
                    add_map_link('table_fantoir_annule','./liste_brute_fantoir.html?insee='+insee,'Topo')
                }

              //Sticky headers : le tableau scrolle dans son contenant
                $('#table_fantoir_annule').tablesorter({
                  widthFixed : true,
                  headerTemplate : '{content} {icon}', // Add icon for various themes
                  widgets: [ 'stickyHeaders', 'filter' ],
                  widgetOptions: {
                    stickyHeaders_attachTo : '#reponse'
                  }
                });
                window.location.hash="#dept="+code_dept
                $('body').css('cursor','default');
            })
        }
    };
</script>
</head>
<body onload="start()">

    <header>
        <!--#include file="includes/menu.html" -->
    </header>

    <div id="barre-jaune">
        <span>Département :</span>
        <form action="javascript:requete_fantoir_annule_dept()" autocomplete="on">
            <input type="text" id="input_dept" placeholder="N° de département"></input>
            <input type="submit" value="Afficher">
        </form>
    </div>

    <div id="bandeau">
        <div id="descriptif">
            <h2></h2>
            <h1>Codes Fantoir annulés</h1>
            <h3>Liste des codes trouvés dans OSM mais annulés d'après le fichier Topo (ex Fantoir) officiel.<br />Cela peut être des noms de voies remplacés par d'autres, des voies en double dont un seul code est conservé...<br />Lors de fusions de communes, celles dont le code Insee disparaît voient leurs codes Fantoir annulés, et remplacés par de nouveaux codes dans la nouvelle commune. Dans ce cas, c'est dans la page de la nouvelle commune qu'il faut chercher le code Fantoir.</h3>
        </div>
        <div id="wait_ajax" class="bas"></div>
    </div>

    <div id="reponse">
        <table id="table_fantoir_annule" class="tablesorter"></table>
    </div>

    <footer>
     <!--#include file="includes/footer.html" -->
    </footer>

    <div id="josm_target" style="visibility : hidden"></div>

</body>
</html>